(function(){jQuery(document).ready(function(a){"use strict";return window.WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler=function(){function b(){this.params=window.wc_first_data_payeezy_params,a(document.body).on("sv_wc_payment_form_valid_payment_data",function(a){return function(b,c){return a.init(b,c)}}(this)),a(document.body).on("updated_checkout",function(a){return function(){return a.handle_saved_payment_methods()}}(this))}return b.prototype.init=function(a,b){return this.payment_form=b.payment_form,"first_data_payeezy_credit_card"!==this.payment_form.id?void 0:this.payment_form.saved_payment_method_selected?void 0:b.passed_validation?this.has_token()?!0:(this.tokenize_card(),!1):void 0},b.prototype.tokenize_card=function(){return this.payment_form.block_ui(),a.ajax({url:this.params.api_url,dataType:"jsonp",data:this.get_request_data(),success:function(a){return function(b){return a.handle_response(b)}}(this)})},b.prototype.get_request_data=function(){var b;return b=a.payment.cardType(a("input[id=wc-first-data-payeezy-credit-card-account-number]").val()),"amex"===b&&(b="American Express"),"dinersclub"===b&&(b="Diners Club"),{apikey:this.params.api_key,js_security_key:this.params.js_security_key,ta_token:this.params.transarmor_token,auth:"false",type:"FDToken","credit_card.type":b,"credit_card.cardholder_name":a("input[name=billing_first_name]").val()+" "+a("input[name=billing_last_name]").val(),"credit_card.card_number":a("input[id=wc-first-data-payeezy-credit-card-account-number]").val(),"credit_card.exp_date":a("input[name=wc-first-data-payeezy-credit-card-expiry]").val().replace(/\s+\/\s+/g,""),"credit_card.cvv":a("input[id=wc-first-data-payeezy-credit-card-csc]").val()}},b.prototype.handle_response=function(a){return null!=a.status&&201===a.status?(this.set_token(a.results.token.value),this.payment_form.form.submit()):(console.log(a),this.payment_form.render_errors([a.results.Error.messages[0].description]),this.payment_form.unblock_ui())},b.prototype.set_token=function(b){var c,d;return a("input[name=wc-first-data-payeezy-credit-card-token").val(b),d=a("input[id=wc-first-data-payeezy-credit-card-account-number]").val().slice(-4),a("input[name=wc-first-data-payeezy-credit-card-last-four").val(d),c=a.payment.cardType(a("input[id=wc-first-data-payeezy-credit-card-account-number]").val()),a("input[name=wc-first-data-payeezy-credit-card-card-type").val(c)},b.prototype.has_token=function(){return a("input[name=wc-first-data-payeezy-credit-card-token").val()},b.prototype.handle_saved_payment_methods=function(){return a("input.js-wc-first-data-payeezy-credit-card-payment-token").change(function(){var b;return b=a("#wc-first-data-payeezy-credit-card-credit-card-form"),a("input.js-wc-first-data-payeezy-credit-card-payment-token:checked").val()?b.hide():b.show()})},b}(),window.wc_first_data_payeezy_credit_card_tokenization_handler=new WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler})}).call(this);