(function(){jQuery(document).ready(function(a){"use strict";return window.WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler=function(){function b(){this.params=window.wc_first_data_payeezy_params,a(document.body).on("sv_wc_payment_form_valid_payment_data",function(a){return function(b,c){return a.init(b,c)}}(this)),a(document.body).on("updated_checkout",function(a){return function(){return a.handle_saved_payment_methods()}}(this))}return b.prototype.init=function(a,b){if(this.payment_form=b.payment_form,"first_data_payeezy_credit_card"===this.payment_form.id&&!this.payment_form.saved_payment_method_selected&&b.passed_validation)return!!this.has_token()||(this.tokenize_card(),!1)},b.prototype.tokenize_card=function(){var b;return this.payment_form.block_ui(),b=this.get_request_data(),this.log_data(b,"request"),a.ajax({url:this.params.api_url,dataType:"jsonp",data:b,success:function(a){return function(b){return a.handle_response(b)}}(this)})},b.prototype.get_request_data=function(){var b,c,d,e;return b=a.payment.cardType(a("input[id=wc-first-data-payeezy-credit-card-account-number]").val()),"amex"===b&&(b="American Express"),"dinersclub"===b&&(b="Diners Club"),e=a("input[name=wc-first-data-payeezy-credit-card-expiry]").val(),c=e.slice(0,e.indexOf(" ")),1===c.length&&(c="0"+c),d=e.slice(-2),{apikey:this.params.api_key,js_security_key:this.params.js_security_key,ta_token:this.params.transarmor_token,auth:"false",type:"FDToken","credit_card.type":b,"credit_card.cardholder_name":a("input[name=billing_first_name]").val()+" "+a("input[name=billing_last_name]").val(),"credit_card.card_number":a("input[id=wc-first-data-payeezy-credit-card-account-number]").val(),"credit_card.exp_date":c+d,"credit_card.cvv":a("input[id=wc-first-data-payeezy-credit-card-csc]").val(),"billing_address.street":a("input[name=billing_address_1]").val(),"billing_address.city":a("#billing_city").val(),"billing_address.state_province":a("#billing_state").val(),"billing_address.zip_postal_code":a("input[name=billing_postcode]").val(),"billing_address.country":a("#billing_country").val()}},b.prototype.handle_response=function(a){return this.log_data(a,"response"),null!=a.status&&201===a.status?(this.set_token(a.results.token.value),this.payment_form.form.submit()):(console.log(a),this.payment_form.render_errors([a.results.Error.messages[0].description]),this.payment_form.unblock_ui())},b.prototype.set_token=function(b){var c,d;return a("input[name=wc-first-data-payeezy-credit-card-token]").val(b),d=a("input[id=wc-first-data-payeezy-credit-card-account-number]").val().slice(-4),a("input[name=wc-first-data-payeezy-credit-card-last-four]").val(d),c=a.payment.cardType(a("input[id=wc-first-data-payeezy-credit-card-account-number]").val()),a("input[name=wc-first-data-payeezy-credit-card-card-type]").val(c)},b.prototype.has_token=function(){return a("input[name=wc-first-data-payeezy-credit-card-token]").val()},b.prototype.handle_saved_payment_methods=function(){var b;return b="js-sv-wc-payment-gateway-credit-card-form-csc",a("input.js-wc-first-data-payeezy-credit-card-payment-token").change(function(){var c;return c=a("#wc-first-data-payeezy-credit-card-credit-card-form"),a("input.js-wc-first-data-payeezy-credit-card-payment-token:checked").val()?(c.hide(),a("#wc-first-data-payeezy-credit-card-csc").removeClass(b)):(a("#wc-first-data-payeezy-credit-card-csc").addClass(b),c.show())})},b.prototype.log_data=function(b,c){var d,e,f;if(this.params.ajax_log){f={};for(e in b)f[e]=b[e];return"credit_card.card_number"in f&&(f["credit_card.card_number"]=f["credit_card.card_number"].replace(/\d(?=\d{4})/g,"*")),"credit_card.cvv"in f&&(f["credit_card.cvv"]=f["credit_card.cvv"].replace(/[0-9]/g,"*")),d={action:"wc_"+this.payment_form.id+"_log_js_data",security:this.params.ajax_log_nonce,type:c,data:f},a.ajax({url:this.params.ajax_url,data:d})}},b}(),window.wc_first_data_payeezy_credit_card_tokenization_handler=new WC_First_Data_Payeezy_Credit_Card_Tokenization_Handler})}).call(this);